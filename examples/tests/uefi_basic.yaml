showtrace: true

early_commands:
  # Recreate and test LP:1722322
  # Make one disk dirty with an MBR and a storage configuration
  # GPT and don't supply wipe: superblock.  This will exercise
  # curtin use of sgdisk --zap-all instead of --clear (GPT only)
  blockmeta: ["parted", /dev/disk/by-id/virtio-disk-b, "--script", "mklabel", "msdos"]

storage:
  config:
  - id: id_disk0
    type: disk
    name: main_disk
    serial: disk-a
    ptable: gpt
    wipe: superblock
    grub_device: true
  - device: id_disk0
    flag: boot
    id: id_disk0_part1
    number: 1
    offset: 1M
    size: 512M
    type: partition
    wipe: superblock
  - device: id_disk0
    id: id_disk0_part2
    number: 2
    size: 3G
    type: partition
    wipe: superblock
  - id: id_disk0_part3
    number: 3
    size: 1G
    type: partition
    wipe: superblock
    device: id_disk0
  - fstype: fat32
    id: id_efi_format
    label: efi
    type: format
    volume: id_disk0_part1
  - fstype: ext4
    id: id_root_format
    label: root
    type: format
    volume: id_disk0_part2
  - id: id_home_format
    label: home
    type: format
    fstype: xfs
    volume: id_disk0_part3
  - device: id_root_format
    id: id_root_mount
    path: /
    type: mount
  - device: id_home_format
    type: mount
    path: /home
    id: id_home_mount
  - device: id_efi_format
    id: id_efi_mount
    path: /boot/efi
    type: mount
  - id: pnum_disk
    type: disk
    serial: disk-b
    name: pnum_disk
    ptable: gpt
  - id: pnum_disk_p1
    type: partition
    number: 1
    size: 1GB
    device: pnum_disk
  - id: pnum_disk_p2
    type: partition
    number: 10
    size: 1GB
    device: pnum_disk
  version: 1
